(function(){var i=[].indexOf||function(e){for(var d=0,c=this.length;d<c;d++)if(d in this&&this[d]===e)return d;return-1};(function(e){return e.fn.getCursorPosition=function(){var d,c,f;d=e(this).get(0);c=0;"selectionStart"in d?c=d.selectionStart:0<=i.call(document,"selection")&&(d.focus(),c=document.selection.createRange(),f=document.selection.createRange().text.length,c.moveStart("character",-d.value.length),c=c.text.length-f);return c}})(jQuery);(function(e){return e.fn.setCursorPosition=function(d,
c){return this.each(function(){var f;if(this.setSelectionRange)return this.focus(),this.setSelectionRange(d,c);if(this.createTextRange)return f=this.createTextRange,f.collapse(!0),f.moveEnd("character",c),f.moveStart("character",d),f.select()})}})(jQuery)}).call(this);(function(){var i,e,d,c,f,b;Array.prototype.type="JList";f=function(a){return a.rest===e.Nil?a.first:""+a.first+" "+f(a.rest)};c=function(){function a(a){this.value=""+a}a.name="Symbol";a.prototype.toString=function(){return"'"+this.value};a.prototype.type="Symbol";return a}();b=new (function(){function a(){}a.name="SymbolFactory";a.prototype.get=function(a){return a in this?this[a]:this[a]=new c(a)};return a}());d=function(){function a(){this.value=null}a.prototype.toString=function(){return"'()"};
a.prototype.type="Nil";return a}();e=function(){function a(){}a.name="Lisp";return a}();i=function(){function a(a){this.value=a}a.name="Boolean";a.prototype.toString=function(){return this.value?"#t":"#f"};a.prototype.type="Boolean";return a}();e.Cons=function(){function a(a,b){this.first=a;this.rest=b}a.prototype.toString=function(){var a;return"Cons"===(a=this.rest.type)||"Nil"===a?"'("+f(this)+")":"'("+this.first.toString()+" . "+this.rest.toString()+")"};a.prototype.type="Cons";return a}();e.False=
new i(!1);e.Nil=new d;e.Number=function(){function a(a){this.value=a}a.prototype.toString=function(){return""+this.value};a.prototype.valueOf=function(){return this.value};a.prototype.type="Number";return a}();e.Quoted=function(){function a(a){this.value=a}a.prototype.type="Quoted";return a}();e.Procedure=function(a,b){b.toString=function(){return"#<procedure:"+a+">"};b.type="Procedure";return b};e.String=function(){function a(a){this.value=a}a.prototype.toString=function(){return'"'+this.value+'"'};
a.prototype.valueOf=function(){return this.value};a.prototype.type="String";return a}();e.Symbol=function(a){return b.get(a)};e.True=new i(!0);window.Lisp=e}).call(this);(function(){var i,e,d,c,f=[].slice;i={"+":new Lisp.Procedure("+",function(b){return b.reduce(function(a,b){return new Lisp.Number(a.value+b.value)})}),"-":new Lisp.Procedure("-",function(b){return b.reduce(function(a,b){return new Lisp.Number(a.value-b.value)})}),"*":new Lisp.Procedure("*",function(b){return b.reduce(function(a,b){return new Lisp.Number(a.value*b.value)})}),"/":new Lisp.Procedure("/",function(b){return b.reduce(function(a,b){return new Lisp.Number(a.value/b.value)})}),">":new Lisp.Procedure(">",
function(b){return b[0]>b[1]?Lisp.True:Lisp.False}),">=":new Lisp.Procedure(">=",function(b){return b[0]>=b[1]?Lisp.True:Lisp.False}),"<":new Lisp.Procedure("<",function(b){return b[0]<b[1]?Lisp.True:Lisp.False}),"<=":new Lisp.Procedure("<=",function(b){return b[0]<=b[1]?Lisp.True:Lisp.False}),"eq?":new Lisp.Procedure("eq?",function(b){return"Number"===b[0].type?b[0].value===b[1].value?Lisp.True:Lisp.False:b[0]===b[1]?Lisp.True:Lisp.False}),"type?":new Lisp.Procedure("type?",function(b){return new Lisp.Symbol(b[0].type)}),
and:new Lisp.Procedure("and",function(b){return b.every(function(a){return a===Lisp.True})?Lisp.True:Lisp.False}),or:new Lisp.Procedure("or",function(b){return b.some(function(a){return a===Lisp.True})?Lisp.True:Lisp.False}),not:new Lisp.Procedure("not",function(b){return b[0]===Lisp.True?Lisp.False:Lisp.True}),cons:new Lisp.Procedure("cons",function(b){return new Lisp.Cons(b[0],b[1])}),first:new Lisp.Procedure("first",function(b){return b[0].first}),rest:new Lisp.Procedure("rest",function(b){return b[0].rest}),
last:new Lisp.Procedure("last",function(b){var a;a=function(b){return b.rest===Lisp.Nil?b.first:a(b.rest)};return a(b[0])}),print:new Lisp.Procedure("print",function(b){var a;a=$("#console");window.FIRST_PRINT?(a.val(""+a.val()+"\n"+b[0].toString()),window.FIRST_PRINT=!1):a.val(""+a.val()+b[0].toString())})};e=function(){function b(a,b,g){var c,h,d;null==a&&(a=[]);null==b&&(b=[]);this.parent=null!=g?g:null;g=h=0;for(d=a.length;h<d;g=++h)c=a[g],this[c.value]=b[g]}b.name="Environment";b.prototype.find=
function(a){try{return a in this?this[a]:this.parent.find(a)}catch(b){throw"reference to undefined identifier: "+a;}};b.prototype.findEnvironment=function(a){try{return a in this?this:this.parent.findEnvironment(a)}catch(b){throw"set!: cannot set variable before its definition: "+a;}};b.prototype.updateValues=function(a){var b,g,c;c=[];for(b in a)g=a[b],c.push(this[b]=g);return c};return b}();c=new e;c.updateValues(i);d=function(b,a){var j,g,o,h,p,l,q,k,i,m;null==a&&(a=c);if("JList"===b.type)switch(b[0].value){case "define":return l=
b[1],g=3<=b.length?f.call(b,2):[],"JList"===l.type?(j=l[0],g.unshift(new Lisp.Symbol("begin")),a[j.value]=new Lisp.Procedure(j.value,function(b){return d(g,new e(l.slice(1),b,a))})):a[l.value]=d(g[0],a);case "lambda":return q=b[1],g=b[2],new Lisp.Procedure("lambda",function(b){return d(g,new e(q,b,a))});case "if":return p=b[1],h=b[2],j=b[3],g=d(p,a)===Lisp.True?h:j,d(g,a);case "let":j=b[1];g=b[2];p=[];h=[];i=0;for(m=j.length;i<m;i++)k=j[i],p.push(k[0]),h.push(d(k[1],a));return d(g,new e(p,h,a));case "set!":return l=
b[1],h=b[2],j=a.findEnvironment(l.value),j[l.value]=d(h,a);case "begin":return o=b.slice(1),function(){var b,c,h;h=[];b=0;for(c=o.length;b<c;b++)g=o[b],h.push(d(g,a));return h}().pop();default:return j=function(){var c,g,h;h=[];c=0;for(g=b.length;c<g;c++)k=b[c],h.push(d(k,a));return h}(),h=j.shift(),h(j)}else return"Symbol"===b.type?a.find(b.value):"Quoted"===b.type?b.value:b};window.evalExpression=d;window.globalEnvironment=c;window.resetGlobalEnvironment=function(){c=new e;return c.updateValues(i)}}).call(this);(function(){var i,e,d;e=function(c){var f;f=c.shift();if("("===f){for(f=[];")"!==c[0];)f.push(e(c));c.shift();return f}if("'("===f){for(f=[];")"!==c[0];)f.push(e(c));c.shift();return new Lisp.Quoted(i(f))}return d(f)};d=function(c){var d;if("true"===c)return Lisp.True;if("false"===c)return Lisp.False;if("nil"===c)return Lisp.Nil;d=Number(c.replace(/^'/,""));return isNaN(d)?"'"===c.charAt(0)?new Lisp.Quoted(new Lisp.Symbol(c.replace(/^'/,""))):'"'===c.charAt(0)?new Lisp.String(c.slice(1,-1)):new Lisp.Symbol(c):
new Lisp.Number(d)};i=function(c){return 0===c.length?Lisp.Nil:new Lisp.Cons(c.shift(),i(c))};window.tokenize=function(c){var d,b,a,e,g;d=/^\s*$/;c=c.replace(/;+.+\n|\n|\r|\t/g," ");c=c.replace(/\(/g," ( ");c=c.replace(/\)/g," ) ");c=c.replace(/'\s+\(/g,"'(");b=c.split(/("[^"]+"|[^"\s]+)/g);g=[];a=0;for(e=b.length;a<e;a++)c=b[a],d.test(c)||g.push(c);return g};window.parseTokens=e}).call(this);(function(){var i,e,d,c,f,b,a,j;$(function(){var b,o,h,i,l;h=$("#input");l=$("#console");i=$("#navbar");b=$("#button-group");b=$(window).height()-(i.height()+b.height())-50;h.height(b);l.height(b);l.val("> ");l.keydown(e);l.keyup(d);l.mousedown(f);$("#run").click(j);$("#save").popover({placement:"bottom",title:"Choose a name",trigger:"manual",content:'<input type="text" id="filename">'});$("#save").click(function(){$(this).popover("toggle");return $("#filename").keydown(a)});h=$("#dropdown");for(o in localStorage)h.append("<li><a href='#'>"+
o+"</a></li>");return h.children().click(c)});c=function(){var a;a=localStorage.getItem(this.firstChild.text);return $("#input").val(a)};a=function(a){var b,d;if(13===a.which)return b=$("#dropdown"),d=$(this),a=$("#input").val(),localStorage.setItem(d.val(),a),$("#save").popover("hide"),b.append("<li><a href='#'>"+d.val()+"</a></li>"),b.children().click(c),d.val("")};j=function(){var a,b,c,d,e,f;d=$("#input").val();a=f=c=e=0;for(b=[];e<d.length;)if("("===d.charAt(e)&&(f+=1,1===f&&0===a&&(c=e)),")"===
d.charAt(e)&&(a+=1),e+=1,0<f&&f===a)a=d.slice(c,e),b.push(a),a=f=0;c=0;for(d=b.length;c<d;c++)a=b[c],evalExpression(parseTokens(tokenize(a)))};f=function(a){var b;b=$("#console");a.preventDefault();a=b.val().length;if(!b.is(":focus"))return b.setCursorPosition(a,a)};b=!1;e=function(){var a,c,d,e;d=[];c=[];a=0;e=void 0;return function(f){var j,k,n,m;b=!1;m=$("#console");n=m.val();k=function(){var a;a=m.getCursorPosition();if(2>=a||"\n> "===n.slice(a-3,a))return f.preventDefault()};switch(f.which){case 38:-1===
a&&(a=c.length-1);if(j=c[a])k=m.val().split("\n").pop(),j=""+n.slice(0,n.lastIndexOf(k))+"> "+j.trim(),m.val(j),a-=1;f.preventDefault();break;case 37:k();break;case 8:k();break;case 13:k=m.val().split("\n").pop();k=k.replace("> ","");d.push(k+" ");k=d.reduce(function(a,b){return a+b});if(i(k)){c.push(k);a=c.length-1;k=tokenize(k);k=parseTokens(k);try{j=evalExpression(k),null!=j&&m.val(""+n+"\n"+j.toString())}catch(r){m.val(""+n+"\n"+r.toString())}b=!0;d=[]}break;case 67:17===e&&(f.preventDefault(),
m.val(n+"\n> "),d=[])}return e=f.which}}();d=function(){var a,c;c=$("#console");if(b)return a=c.val(),c.val(a+"> "),window.FIRST_PRINT=!0};i=function(a){var b;b=a.split("(").length-1;a=a.split(")").length-1;return b<=a};window.FIRST_PRINT=!0}).call(this);
