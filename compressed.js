(function(){var i=[].indexOf||function(e){for(var d=0,c=this.length;d<c;d++)if(d in this&&this[d]===e)return d;return-1};(function(e){return e.fn.getCursorPosition=function(){var d,c,f;d=e(this).get(0);c=0;"selectionStart"in d?c=d.selectionStart:0<=i.call(document,"selection")&&(d.focus(),c=document.selection.createRange(),f=document.selection.createRange().text.length,c.moveStart("character",-d.value.length),c=c.text.length-f);return c}})(jQuery);(function(e){return e.fn.setCursorPosition=function(d,
c){return this.each(function(){var f;if(this.setSelectionRange)return this.focus(),this.setSelectionRange(d,c);if(this.createTextRange)return f=this.createTextRange,f.collapse(!0),f.moveEnd("character",c),f.moveStart("character",d),f.select()})}})(jQuery)}).call(this);(function(){var i,e,d,c,f,a;Array.prototype.type="JList";f=function(b){return b.rest===e.Nil?b.first:""+b.first+" "+f(b.rest)};c=function(){function b(b){this.value=""+b}b.name="Symbol";b.prototype.toString=function(){return"'"+this.value};b.prototype.type="Symbol";return b}();a=new (function(){function b(){}b.name="SymbolFactory";b.prototype.get=function(b){return b in this?this[b]:this[b]=new c(b)};return b}());d=function(){function b(){this.value=null}b.prototype.toString=function(){return"'()"};
b.prototype.type="Nil";return b}();e=function(){function b(){}b.name="Lisp";return b}();i=function(){function b(b){this.value=b}b.name="Boolean";b.prototype.toString=function(){return this.value?"#t":"#f"};b.prototype.type="Boolean";return b}();e.Cons=function(){function b(b,a){this.first=b;this.rest=a}b.prototype.toString=function(){var b;return"Cons"===(b=this.rest.type)||"Nil"===b?"'("+f(this)+")":"'("+this.first.toString()+" . "+this.rest.toString()+")"};b.prototype.type="Cons";return b}();e.False=
new i(!1);e.Nil=new d;e.Number=function(){function b(b){this.value=b}b.prototype.toString=function(){return""+this.value};b.prototype.valueOf=function(){return this.value};b.prototype.type="Number";return b}();e.Quoted=function(){function b(b){this.value=b}b.prototype.type="Quoted";return b}();e.Procedure=function(b,a){a.toString=function(){return"#<procedure:"+b+">"};a.type="Procedure";return a};e.String=function(){function b(b){this.value=b}b.prototype.toString=function(){return'"'+this.value+'"'};
b.prototype.valueOf=function(){return this.value};b.prototype.type="String";return b}();e.Symbol=function(b){return a.get(b)};e.True=new i(!0);window.Lisp=e}).call(this);(function(){var i,e,d,c,f=[].slice;i={"+":new Lisp.Procedure("+",function(a){return a.reduce(function(b,a){return new Lisp.Number(b.value+a.value)})}),"-":new Lisp.Procedure("-",function(a){return a.reduce(function(b,a){return new Lisp.Number(b.value-a.value)})}),"*":new Lisp.Procedure("*",function(a){return a.reduce(function(b,a){return new Lisp.Number(b.value*a.value)})}),"/":new Lisp.Procedure("/",function(a){return a.reduce(function(b,a){return new Lisp.Number(b.value/a.value)})}),">":new Lisp.Procedure(">",
function(a){return a[0]>a[1]?Lisp.True:Lisp.False}),">=":new Lisp.Procedure(">=",function(a){return a[0]>=a[1]?Lisp.True:Lisp.False}),"<":new Lisp.Procedure("<",function(a){return a[0]<a[1]?Lisp.True:Lisp.False}),"<=":new Lisp.Procedure("<=",function(a){return a[0]<=a[1]?Lisp.True:Lisp.False}),"eq?":new Lisp.Procedure("eq?",function(a){return"Number"===a[0].type?a[0].value===a[1].value?Lisp.True:Lisp.False:a[0]===a[1]?Lisp.True:Lisp.False}),"type?":new Lisp.Procedure("type?",function(a){return new Lisp.Symbol(a[0].type)}),
and:new Lisp.Procedure("and",function(a){return a.every(function(b){return b===Lisp.True})?Lisp.True:Lisp.False}),or:new Lisp.Procedure("or",function(a){return a.some(function(b){return b===Lisp.True})?Lisp.True:Lisp.False}),not:new Lisp.Procedure("not",function(a){return a[0]===Lisp.True?Lisp.False:Lisp.True}),cons:new Lisp.Procedure("cons",function(a){return new Lisp.Cons(a[0],a[1])}),first:new Lisp.Procedure("first",function(a){return a[0].first}),rest:new Lisp.Procedure("rest",function(a){return a[0].rest}),
last:new Lisp.Procedure("last",function(a){var b;b=function(a){return a.rest===Lisp.Nil?a.first:b(a.rest)};return b(a[0])}),print:new Lisp.Procedure("print",function(a){document.getElementById("console").value+=a[0].toString()})};e=function(){function a(b,a,g){var c,h,d;null==b&&(b=[]);null==a&&(a=[]);this.parent=null!=g?g:null;g=h=0;for(d=b.length;h<d;g=++h)c=b[g],this[c.value]=a[g]}a.name="Environment";a.prototype.find=function(b){try{return b in this?this[b]:this.parent.find(b)}catch(a){throw"reference to undefined identifier: "+
b;}};a.prototype.findEnvironment=function(b){try{return b in this?this:this.parent.findEnvironment(b)}catch(a){throw"set!: cannot set variable before its definition: "+b;}};a.prototype.updateValues=function(b){var a,g,c;c=[];for(a in b)g=b[a],c.push(this[a]=g);return c};return a}();c=new e;c.updateValues(i);d=function(a,b){var j,g,o,h,p,l,q,k,i,m;null==b&&(b=c);if("JList"===a.type)switch(a[0].value){case "define":return l=a[1],g=3<=a.length?f.call(a,2):[],"JList"===l.type?(j=l[0],g.unshift(new Lisp.Symbol("begin")),
b[j.value]=new Lisp.Procedure(j.value,function(a){return d(g,new e(l.slice(1),a,b))})):b[l.value]=d(g[0],b);case "lambda":return q=a[1],g=a[2],new Lisp.Procedure("lambda",function(a){return d(g,new e(q,a,b))});case "if":return p=a[1],h=a[2],j=a[3],g=d(p,b)===Lisp.True?h:j,d(g,b);case "let":j=a[1];g=a[2];p=[];h=[];i=0;for(m=j.length;i<m;i++)k=j[i],p.push(k[0]),h.push(d(k[1],b));return d(g,new e(p,h,b));case "set!":return l=a[1],h=a[2],j=b.findEnvironment(l.value),j[l.value]=d(h,b);case "begin":return o=
a.slice(1),function(){var a,c,h;h=[];a=0;for(c=o.length;a<c;a++)g=o[a],h.push(d(g,b));return h}().pop();default:return j=function(){var c,g,h;h=[];c=0;for(g=a.length;c<g;c++)k=a[c],h.push(d(k,b));return h}(),h=j.shift(),h(j)}else return"Symbol"===a.type?b.find(a.value):"Quoted"===a.type?a.value:a};window.evalExpression=d;window.globalEnvironment=c;window.resetGlobalEnvironment=function(){c=new e;return c.updateValues(i)}}).call(this);(function(){var i,e,d;e=function(c){var f;f=c.shift();if("("===f){for(f=[];")"!==c[0];)f.push(e(c));c.shift();return f}if("'("===f){for(f=[];")"!==c[0];)f.push(e(c));c.shift();return new Lisp.Quoted(i(f))}return d(f)};d=function(c){var d;if("true"===c)return Lisp.True;if("false"===c)return Lisp.False;if("nil"===c)return Lisp.Nil;d=Number(c.replace(/^'/,""));return isNaN(d)?"'"===c.charAt(0)?new Lisp.Quoted(new Lisp.Symbol(c.replace(/^'/,""))):'"'===c.charAt(0)?new Lisp.String(c.slice(1,-1)):new Lisp.Symbol(c):
new Lisp.Number(d)};i=function(c){return 0===c.length?Lisp.Nil:new Lisp.Cons(c.shift(),i(c))};window.tokenize=function(c){var d,a,b,e,g;d=/^\s*$/;c=c.replace(/;+.+\n|\n|\r|\t/g," ");c=c.replace(/\(/g," ( ");c=c.replace(/\)/g," ) ");c=c.replace(/'\s+\(/g,"'(");a=c.split(/("[^"]+"|[^"\s]+)/g);g=[];b=0;for(e=a.length;b<e;b++)c=a[b],d.test(c)||g.push(c);return g};window.parseTokens=e}).call(this);(function(){var i,e,d,c,f,a,b,j;$(function(){var a,o,h,i,l;h=$("#input");l=$("#console");i=$("#navbar");a=$("#button-group");a=$(window).height()-(i.height()+a.height())-50;h.height(a);l.height(a);l.val("> ");l.keydown(e);l.keyup(d);l.mousedown(f);$("#run").click(j);$("#save").popover({placement:"bottom",title:"Choose a name",trigger:"manual",content:'<input type="text" id="filename">'});$("#save").click(function(){$(this).popover("toggle");return $("#filename").keydown(b)});h=$("#dropdown");for(o in localStorage)h.append("<li><a href='#'>"+
o+"</a></li>");return h.children().click(c)});c=function(){var a;a=localStorage.getItem(this.firstChild.text);return $("#input").val(a)};b=function(a){var b,d;if(13===a.which)return b=$("#dropdown"),d=$(this),a=$("#input").val(),localStorage.setItem(d.val(),a),$("#save").popover("hide"),b.append("<li><a href='#'>"+d.val()+"</a></li>"),b.children().click(c),d.val("")};j=function(){var a,b,c,d,e,f;d=$("#input").val();a=f=c=e=0;for(b=[];e<d.length;)if("("===d.charAt(e)&&(f+=1,1===f&&0===a&&(c=e)),")"===
d.charAt(e)&&(a+=1),e+=1,0<f&&f===a)a=d.slice(c,e),b.push(a),a=f=0;c=0;for(d=b.length;c<d;c++)a=b[c],evalExpression(parseTokens(tokenize(a)))};f=function(a){var b;b=$("#console");a.preventDefault();a=b.val().length;if(!b.is(":focus"))return b.setCursorPosition(a,a)};a=!1;e=function(){var b,c,d,e;d=[];c=[];b=0;e=void 0;return function(f){var j,k,n,m;a=!1;m=$("#console");n=m.val();k=function(){var a;a=m.getCursorPosition();if(2>=a||"\n> "===n.slice(a-3,a))return f.preventDefault()};switch(f.which){case 38:-1===
b&&(b=c.length-1);if(j=c[b])k=m.val().split("\n").pop(),j=""+n.slice(0,n.lastIndexOf(k))+"> "+j.trim(),m.val(j),b-=1;f.preventDefault();break;case 37:k();break;case 8:k();break;case 13:k=m.val().split("\n").pop();k=k.replace("> ","");d.push(k+" ");k=d.reduce(function(a,b){return a+b});if(i(k)){c.push(k);b=c.length-1;k=tokenize(k);k=parseTokens(k);try{j=evalExpression(k),null!=j&&m.val(""+n+"\n"+j.toString())}catch(r){m.val(""+n+"\n"+r.toString())}a=!0;d=[]}break;case 67:17===e&&(f.preventDefault(),
m.val(n+"\n> "),d=[])}return e=f.which}}();d=function(){var b,c;c=$("#console");if(a)return b=c.val(),c.val(b+"> ")};i=function(a){var b;b=a.split("(").length-1;a=a.split(")").length-1;return b<=a}}).call(this);
