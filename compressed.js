(function(){var h=[].indexOf||function(b){for(var e=0,a=this.length;e<a;e++)if(e in this&&this[e]===b)return e;return-1};(function(b){return b.fn.getCursorPosition=function(){var e,a,c;e=b(this).get(0);a=0;"selectionStart"in e?a=e.selectionStart:0<=h.call(document,"selection")&&(e.focus(),a=document.selection.createRange(),c=document.selection.createRange().text.length,a.moveStart("character",-e.value.length),a=a.text.length-c);return a}})(jQuery);(function(b){return b.fn.setCursorPosition=function(b,
a){return this.each(function(){var c;if(this.setSelectionRange)return this.focus(),this.setSelectionRange(b,a);if(this.createTextRange)return c=this.createTextRange,c.collapse(!0),c.moveEnd("character",a),c.moveStart("character",b),c.select()})}})(jQuery)}).call(this);(function(){var h,b,e,a,c,d,f,g,i,n;Array.prototype.type="JList";g=function(a){return a.rest===Lisp.Nil?a.first:""+a.first+" "+g(a.rest)};n=function(a,d,b){var c,i,f,g,e;e=[];i=f=0;for(g=d.length;f<g;i=++f){c=d[i];if(c.type!==b)throw""+a+": expects type <"+b+"> as "+(i+1)+" argument, given: "+c.type;e.push(void 0)}return e};f=function(){function a(d){this.value=""+d}a.name="LispSymbol";a.prototype.toString=function(){return"'"+this.value};a.prototype.type="Symbol";return a}();i=new (function(){function a(){}
a.name="SymbolFactory";a.prototype.get=function(a){return a in this?this[a]:this[a]=new f(a)};return a}());e=function(){function a(){this.value=null}a.name="LispNil";a.prototype.toString=function(){return"'()"};a.prototype.type="Nil";return a}();h=function(){function a(d){this.value=d}a.name="LispBoolean";a.prototype.toString=function(){return this.value?"#t":"#f"};a.prototype.type="Boolean";return a}();b=function(){function a(d,b){this.first=d;this.rest=b}a.name="LispCons";a.prototype.toString=function(){var a;
return"Cons"===(a=this.rest.type)||"Nil"===a?"'("+g(this)+")":"'("+this.first.toString()+" . "+this.rest.toString()+")"};a.prototype.type="Cons";return a}();a=function(){function a(d){this.value=d}a.name="LispNumber";a.prototype.toString=function(){return""+this.value};a.prototype.valueOf=function(){return this.value};a.prototype.type="Number";return a}();c=function(){function a(d){this.value=d}a.name="LispQuoted";a.prototype.type="Quoted";return a}();d=function(){function a(d){this.value=d}a.name=
"LispString";a.prototype.toString=function(){return'"'+this.value+'"'};a.prototype.valueOf=function(){return this.value};a.prototype.type="String";return a}();window.Lisp={Cons:b,False:new h(!1),Nil:new e,Number:a,Procedure:function(a,d,b){var c;c=function(c){"Any"!==d&&n(a,c,d);return b(c)};c.toString=function(){return"#<procedure:"+a+">"};c.type="Procedure";return c},Quoted:c,String:d,Symbol:function(a){return i.get(a)},True:new h(!0)}}).call(this);(function(){var h,b,e,a,c=[].slice;h={"+":new Lisp.Procedure("+","Number",function(a){return a.reduce(function(a,d){return new Lisp.Number(a.value+d.value)})}),"-":new Lisp.Procedure("-","Number",function(a){return a.reduce(function(a,d){return new Lisp.Number(a.value-d.value)})}),"*":new Lisp.Procedure("*","Number",function(a){return a.reduce(function(a,d){return new Lisp.Number(a.value*d.value)})}),"/":new Lisp.Procedure("/","Number",function(a){return a.reduce(function(a,d){return new Lisp.Number(a.value/
d.value)})}),">":new Lisp.Procedure(">","Number",function(a){return a[0]>a[1]?Lisp.True:Lisp.False}),">=":new Lisp.Procedure(">=","Number",function(a){return a[0]>=a[1]?Lisp.True:Lisp.False}),"<":new Lisp.Procedure("<","Number",function(a){return a[0]<a[1]?Lisp.True:Lisp.False}),"<=":new Lisp.Procedure("<=","Number",function(a){return a[0]<=a[1]?Lisp.True:Lisp.False}),"eq?":new Lisp.Procedure("eq?","Any",function(a){return"Number"===a[0].type?a[0].value===a[1].value?Lisp.True:Lisp.False:a[0]===a[1]?
Lisp.True:Lisp.False}),"type?":new Lisp.Procedure("type?","Any",function(a){return new Lisp.Symbol(a[0].type)}),and:new Lisp.Procedure("and","Boolean",function(a){return a.every(function(a){return a===Lisp.True})?Lisp.True:Lisp.False}),or:new Lisp.Procedure("or","Boolean",function(a){return a.some(function(a){return a===Lisp.True})?Lisp.True:Lisp.False}),not:new Lisp.Procedure("not","Boolean",function(a){return a[0]===Lisp.True?Lisp.False:Lisp.True}),cons:new Lisp.Procedure("cons","Any",function(a){return new Lisp.Cons(a[0],
a[1])}),first:new Lisp.Procedure("first","Cons",function(a){return a[0].first}),rest:new Lisp.Procedure("rest","Cons",function(a){return a[0].rest}),last:new Lisp.Procedure("last","Cons",function(a){var b;b=function(a){return a.rest===Lisp.Nil?a.first:b(a.rest)};return b(a[0])}),print:new Lisp.Procedure("print","Any",function(a){var b;b=$("#console");window.FIRST_PRINT?(b.val(""+b.val()+"\n"+a[0].toString()),window.FIRST_PRINT=!1):b.val(""+b.val()+a[0].toString())})};b=function(){function a(b,c,d){var e,
j,o;null==b&&(b=[]);null==c&&(c=[]);this.parent=null!=d?d:null;d=j=0;for(o=b.length;j<o;d=++j)e=b[d],this[e.value]=c[d]}a.name="Environment";a.prototype.find=function(a){try{return a in this?this[a]:this.parent.find(a)}catch(b){throw"reference to undefined identifier: "+a;}};a.prototype.findEnvironment=function(a){try{return a in this?this:this.parent.findEnvironment(a)}catch(b){throw"set!: cannot set variable before its definition: "+a;}};a.prototype.updateValues=function(a){var b,c,d;d=[];for(b in a)c=
a[b],d.push(this[b]=c);return d};return a}();a=new b;a.updateValues(h);e=function(d,f){var g,i,n,j,o,l,q,k,h,m;null==f&&(f=a);if("JList"===d.type)switch(d[0].value){case "define":return l=d[1],i=3<=d.length?c.call(d,2):[],"JList"===l.type?(g=l[0],i.unshift(new Lisp.Symbol("begin")),f[g.value]=new Lisp.Procedure(g.value,"Any",function(a){return e(i,new b(l.slice(1),a,f))})):f[l.value]=e(i[0],f);case "lambda":return q=d[1],i=d[2],new Lisp.Procedure("lambda","Any",function(a){return e(i,new b(q,a,f))});
case "if":return o=d[1],j=d[2],g=d[3],i=e(o,f)===Lisp.True?j:g,e(i,f);case "let":g=d[1];i=d[2];o=[];j=[];h=0;for(m=g.length;h<m;h++)k=g[h],o.push(k[0]),j.push(e(k[1],f));return e(i,new b(o,j,f));case "set!":return l=d[1],j=d[2],g=f.findEnvironment(l.value),g[l.value]=e(j,f);case "begin":return n=d.slice(1),function(){var a,b,c;c=[];a=0;for(b=n.length;a<b;a++)i=n[a],c.push(e(i,f));return c}().pop();default:return g=function(){var a,b,c;c=[];a=0;for(b=d.length;a<b;a++)k=d[a],c.push(e(k,f));return c}(),
j=g.shift(),j(g)}else return"Symbol"===d.type?f.find(d.value):"Quoted"===d.type?d.value:d};window.evalExpression=e;window.globalEnvironment=a;window.resetGlobalEnvironment=function(){a=new b;return a.updateValues(h)}}).call(this);(function(){var h,b,e;b=function(a){var c;c=a.shift();if("("===c){for(c=[];")"!==a[0];)c.push(b(a));a.shift();return c}if("'("===c){for(c=[];")"!==a[0];)c.push(b(a));a.shift();return new Lisp.Quoted(h(c))}return e(c)};e=function(a){var b;if("true"===a)return Lisp.True;if("false"===a)return Lisp.False;if("nil"===a)return Lisp.Nil;b=Number(a.replace(/^'/,""));return isNaN(b)?"'"===a.charAt(0)?new Lisp.Quoted(new Lisp.Symbol(a.replace(/^'/,""))):'"'===a.charAt(0)?new Lisp.String(a.slice(1,-1)):new Lisp.Symbol(a):
new Lisp.Number(b)};h=function(a){return 0===a.length?Lisp.Nil:new Lisp.Cons(a.shift(),h(a))};window.tokenize=function(a){var b,d,e,g,i;b=/^\s*$/;a=a.replace(/;+.+\n|\n|\r|\t/g," ");a=a.replace(/\(/g," ( ");a=a.replace(/\)/g," ) ");a=a.replace(/'\s+\(/g,"'(");d=a.split(/("[^"]+"|[^"\s]+)/g);i=[];e=0;for(g=d.length;e<g;e++)a=d[e],b.test(a)||i.push(a);return i};window.parseTokens=b}).call(this);(function(){var h,b,e,a,c,d,f,g;$(function(){var d,n,j,h,l;j=$("#input");l=$("#console");h=$("#navbar");d=$("#button-group");d=$(window).height()-(h.height()+d.height())-50;j.height(d);l.height(d);l.val("> ");l.keydown(b);l.keyup(e);l.mousedown(c);$("#run").click(function(){var a,b,d,c;b=g(j.val());d=0;for(c=b.length;d<c;d++)a=b[d],evalExpression(parseTokens(tokenize(a)));return l.val(""+l.val()+" ran "+b.length+" statements\n> ")});$("#compile").click(function(){var a,b,d,c,i;d=g(j.val());a="";c=
0;for(i=d.length;c<i;c++)b=d[c],a+=Compiler.compile(parseTokens(tokenize(b))),a+="\n";a=a.replace(/;{2,}/g,";");return j.val(""+j.val()+"\n *** GENERATED JAVASCRIPT ***\n"+a)});$("#save").popover({placement:"bottom",title:"Choose a name",trigger:"manual",content:'<input type="text" id="filename">'});$("#save").click(function(){$(this).popover("toggle");return $("#filename").keydown(f)});j.keydown(function(a){var b;if(9===a.which)return a.preventDefault(),b=j.val(),a=j.getCursorPosition(),j.val(b.slice(0,
a)+"\t"+b.slice(a))});d=$("#dropdown");for(n in localStorage)d.append("<li><a href='#'>"+n+"</a></li>");return d.children().click(a)});a=function(){var a;a=localStorage.getItem(this.firstChild.text);return $("#input").val(a)};f=function(b){var d,c;if(13===b.which)return d=$("#dropdown"),c=$(this),b=$("#input").val(),localStorage.setItem(c.val(),b),$("#save").popover("hide"),d.append("<li><a href='#'>"+c.val()+"</a></li>"),d.children().click(a),c.val("")};g=function(){var a,b,d,c,e,f;c=$("#input").val();
-1!==c.indexOf("*** GENERATED JAVASCRIPT ***")&&(c=c.substring(0,c.indexOf("*** GENERATED JAVASCRIPT ***")));a=f=d=e=0;for(b=[];e<c.length;)if("("===c.charAt(e)&&(f+=1,1===f&&0===a&&(d=e)),")"===c.charAt(e)&&(a+=1),e+=1,0<f&&f===a)a=c.slice(d,e),b.push(a),a=f=0;return b};c=function(a){var b;b=$("#console");a.preventDefault();a=b.val().length;if(!b.is(":focus"))return b.setCursorPosition(a,a)};d=!1;b=function(){var a,b,c,e;c=[];b=[];a=0;e=void 0;return function(f){var g,k,p,m;d=!1;m=$("#console");
p=m.val();k=function(){var a;a=m.getCursorPosition();if(2>=a||"\n> "===p.slice(a-3,a))return f.preventDefault()};switch(f.which){case 38:-1===a&&(a=b.length-1);if(g=b[a])k=m.val().split("\n").pop(),g=""+p.slice(0,p.lastIndexOf(k))+"> "+g.trim(),m.val(g),a-=1;f.preventDefault();break;case 37:k();break;case 8:k();break;case 13:k=m.val().split("\n").pop();k=k.replace("> ","");c.push(k+" ");k=c.reduce(function(a,b){return a+b});if(h(k)){b.push(k);a=b.length-1;k=tokenize(k);k=parseTokens(k);try{g=evalExpression(k),
null!=g&&m.val(""+p+"\n"+g.toString())}catch(r){m.val(""+p+"\n"+r.toString())}d=!0;c=[]}break;case 67:17===e&&(f.preventDefault(),m.val(p+"\n> "),c=[])}return e=f.which}}();e=function(){var a,b;b=$("#console");if(d)return a=b.val(),b.val(a+"> "),window.FIRST_PRINT=!0};h=function(a){var b;b=a.split("(").length-1;a=a.split(")").length-1;return b<=a};window.FIRST_PRINT=!0}).call(this);(function(){var h;h=function(b,e){var a,c,d;if(b.length!==e.length)return!1;a=c=0;for(d=b.length;c<d;a=++c)if(b[a]!==e[a])return!1;return!0};window.__EQ=function(b,e){return b instanceof Array&&e instanceof Array?h(b,e):b===e}}).call(this);(function(){var h,b,e;e={cons:function(a){return"[].concat("+b(a[0])+", "+b(a[1])+")"},"+":function(a){return"("+a.reduce(function(a,d){return""+b(a)+" + "+b(d)})+")"},"-":function(a){return"("+a.reduce(function(a,d){return""+b(a)+" - "+b(d)})+")"},"*":function(a){return"("+a.reduce(function(a,d){return""+b(a)+" * "+b(d)})+")"},"/":function(a){return"("+a.reduce(function(a,d){return""+b(a)+" / "+b(d)})+")"},"eq?":function(a){return"__EQ("+b(a[0])+", "+b(a[1])+")"},"<":function(a){return"("+b(a[0])+
" < "+b(a[1])+")"},">":function(a){return"("+b(a[0])+" > "+b(a[1])+")"},">=":function(a){return"("+b(a[0])+" >= "+b(a[1])+")"},"<=":function(a){return"("+b(a[0])+" <= "+b(a[1])+")"},not:function(a){return"!("+b(a[0])+")"},and:function(a){return"("+a.reduce(function(a,d){return""+b(a)+" && "+b(d)})+")"},or:function(a){return"("+a.reduce(function(a,d){return""+b(a)+" || "+b(d)})+")"},first:function(a){return""+b(a[0])+"[0]"},rest:function(a){return""+b(a[0])+".slice(1)"},last:function(a){return""+b(a[0])+
".slice(-1)[0]"},define:function(a){var c,d;return"JList"===a[0].type?(c="var "+b(a[0][0])+" = function(",d=a[0].slice(1),0===d.length?b(a[0][0]):c=1===d.length?c+b(a[0][1]):c+d.reduce(function(a,d){return""+b(a)+", "+b(d)}),c+=") {\n",a.slice(1).forEach(function(a,d,e){return d===e.length-1?c+="\treturn "+b(a)+";\n":c+="\t"+b(a)+";\n"}),c+="};"):"var "+b(a[0])+" = "+b(a[1])+";"},"set!":function(a){return""+b(a[0])+" = "+b(a[1])},lambda:function(a){var c;0===a[0].length?c="":1===a[0].length?c=b(a[0][0]):
1<a[0].length&&(c=a[0].reduce(function(a,c){return""+b(a)+", "+b(c)}));return"function("+c+") {\n"+("\treturn "+b(a[1])+";\n")+"}"},begin:function(a){var c;c="(function() {\n";c=1===a.length?c+("\treturn "+b(a[0])+";\n"):c+a.reduce(function(a,c,e,h){return e===h.length-1?"\t"+b(a)+";\n\treturn "+b(c)+";":""+b(a)+";\n\t"+b(c)});return c+="\n})();"},"if":function(a){return"("+b(a[0])+") ? "+b(a[1])+" : "+b(a[2])},print:function(a){return"console.log("+b(a[0])+");"},let:function(a){var c;c="(function() { ";
a[0].forEach(function(a){return c+="var "+b(a[0])+" = "+b(a[1])+"; "});return c+="return "+b(a[1])+"; })()"}};h=function(a){return"Nil"!==a.rest.type?""+b(a.first)+", "+h(a.rest):""+b(a.first)};b=function(a){var c;switch(a.type){case "JList":if(a[0].value in e)return e[a[0].value](a.slice(1));c=a.slice(1);return 0===c.length?""+b(a[0])+"()":1===c.length?""+b(a[0])+"("+b(c[0])+")":""+b(a[0])+"("+a.slice(1).reduce(function(a,c){return""+b(a)+", "+b(c)})+")";case "Symbol":return a.toString().slice(1);
case "Boolean":return a.value.toString();case "Quoted":return"Cons"===a.value.type?"["+h(a.value)+"]":"Symbol"===a.value.type?'"'+a.value.value+'"':b(a.value);case "Nil":return"[]";default:return a.toString()}};window.Compiler={compile:b}}).call(this);
